<body>
  <h1>Vocab Check</h1>

  <div id="app">
    <label>
      학생 ID
      <input id="studentIdInput" placeholder="예: khh0728" />
    </label>
    <button id="loadBtn">불러오기</button>

    <p id="status"></p>
  </div>

<script>
  const input = document.getElementById("studentIdInput");
  const button = document.getElementById("loadBtn");
  const status = document.getElementById("status");

  async function loadStudentIndex(studentIdRaw) {
    const id = studentIdRaw.trim().toLowerCase();
    const prefix = id.slice(0, 2);
    const indexPath = `data/students/${prefix}/${id}/index.json`;

    status.textContent = `불러오는 중... (${indexPath})`;

    const res = await fetch(indexPath, { cache: "no-store" });
    if (!res.ok) throw new Error(`index.json 로드 실패: ${res.status}`);

    const data = await res.json();

    if (!data || !Array.isArray(data.sets)) {
      throw new Error("index.json 형식 오류: sets 배열이 없습니다.");
    }

    return { id, indexPath, data };
  }

  button.addEventListener("click", async () => {
    const raw = input.value;
    if (!raw.trim()) {
      status.textContent = "ID를 입력하세요.";
      return;
    }

    try {
      const { id, indexPath, data } = await loadStudentIndex(raw);

      status.textContent = `✅ ${id} 세트 ${data.sets.length}개 로드됨`;
      console.log("indexPath:", indexPath);
      console.log("학생 index.json:", data);
    } catch (err) {
      console.error(err);
      status.textContent = `❌ 불러오기 실패: ${err.message}`;
    }
  });
</script>

</body>
